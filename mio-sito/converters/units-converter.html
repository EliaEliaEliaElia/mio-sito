<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Unit Converter | ToolFast</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>

    <header></header>

    <main class="container">
        <section class="tool-card">
            <h1>Universal Unit Converter</h1>
            <p>Convert length, weight, temperature, digital storage, and more in real-time.</p>

            <div style="margin: 2rem 0; text-align: left; display: flex; flex-direction: column; gap: 20px;">
                
                <div>
                    <label for="categorySelect" style="display: block; font-weight: bold; margin-bottom: 8px;">Select Category</label>
                    <select id="categorySelect" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; background: white; font-size: 1rem;">
                        <option value="length">Length</option>
                        <option value="weight">Weight / Mass</option>
                        <option value="temp">Temperature</option>
                        <option value="digital">Digital Storage</option>
                        <option value="time">Time</option>
                        <option value="area">Area</option>
                    </select>
                </div>

                <div style="display: flex; gap: 15px; align-items: flex-start; flex-wrap: wrap;">
                    
                    <div style="flex: 1; min-width: 150px;">
                        <label for="inputVal" style="display: block; font-size: 0.8rem; margin-bottom: 5px; color: var(--text-light);">From</label>
                        <input type="number" id="inputVal" value="1" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd;">
                        
                        <label for="inputUnit" style="display:none;">Input Unit</label>
                        <select id="inputUnit" style="width: 100%; margin-top: 8px; padding: 10px; border-radius: 5px; border: 1px solid #eee;"></select>
                    </div>
                    
                    <div style="align-self: center; font-size: 1.5rem; font-weight: bold; color: var(--primary); padding-top: 20px;">=</div>

                    <div style="flex: 1; min-width: 150px;">
                        <label for="outputVal" style="display: block; font-size: 0.8rem; margin-bottom: 5px; color: var(--text-light);">To</label>
                        <input type="text" id="outputVal" readonly style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; background: #f8fafc; font-weight: bold;">
                        
                        <label for="outputUnit" style="display:none;">Output Unit</label>
                        <select id="outputUnit" style="width: 100%; margin-top: 8px; padding: 10px; border-radius: 5px; border: 1px solid #eee;"></select>
                    </div>
                </div>
            </div>

            <button onclick="swapUnits()" class="btn-primary" style="background-color: #64748b; width: auto; padding: 10px 20px;">Swap Units ⇄</button>
        </section>
    </main>

    <footer></footer>

    <script src="../components.js"></script>
    <script>
        // Database dei fattori di conversione (riferiti all'unità base di ogni categoria)
        const unitsData = {
            length: { m: 1, km: 1000, cm: 0.01, mm: 0.001, mi: 1609.34, yd: 0.9144, ft: 0.3048, in: 0.0254, nmi: 1852 },
            weight: { g: 1, kg: 1000, mg: 0.001, lb: 453.592, oz: 28.3495, t: 1000000, st: 6350.29 },
            digital: { bit: 1, byte: 8, KB: 8192, MB: 8388608, GB: 8589934592, TB: 8796093022208 },
            time: { sec: 1, min: 60, hr: 3600, day: 86400, week: 604800, year: 31536000 },
            area: { m2: 1, km2: 1000000, ha: 10000, acre: 4046.86, ft2: 0.092903 },
            temp: { C: 1, F: 1, K: 1 } // Logica speciale gestita a parte
        };

        const categorySelect = document.getElementById('categorySelect');
        const inputUnit = document.getElementById('inputUnit');
        const outputUnit = document.getElementById('outputUnit');
        const inputVal = document.getElementById('inputVal');
        const outputVal = document.getElementById('outputVal');

        // Popola i selettori in base alla categoria
        function populateUnits() {
            const category = categorySelect.value;
            const units = Object.keys(unitsData[category]);
            
            inputUnit.innerHTML = units.map(u => `<option value="${u}">${u}</option>`).join('');
            outputUnit.innerHTML = units.map(u => `<option value="${u}">${u}</option>`).join('');
            
            // Imposta una seconda unità diversa per default se possibile
            if (units.length > 1) outputUnit.selectedIndex = 1;
            
            convert();
        }

        // Funzione di calcolo universale
        function convert() {
            const category = categorySelect.value;
            const val = parseFloat(inputVal.value);
            
            if (isNaN(val)) {
                outputVal.value = "";
                return;
            }

            const from = inputUnit.value;
            const to = outputUnit.value;
            let result;

            if (category === 'temp') {
                result = convertTemperature(val, from, to);
            } else {
                // Formula: (Valore * Fattore_Origine) / Fattore_Destinazione
                const baseValue = val * unitsData[category][from];
                result = baseValue / unitsData[category][to];
            }

            // Arrotondamento a 6 decimali pulito (rimuove zeri superflui)
            outputVal.value = Number(result.toFixed(15));
        }

        // Formule specifiche per la Temperatura
        function convertTemperature(v, from, to) {
            if (from === to) return v;
            let celsius;
            
            // 1. Converti tutto in Celsius
            if (from === "C") celsius = v;
            else if (from === "F") celsius = (v - 32) * 5 / 9;
            else if (from === "K") celsius = v - 273.15;

            // 2. Converti da Celsius al target
            if (to === "C") return celsius;
            else if (to === "F") return (celsius * 9 / 5) + 32;
            else if (to === "K") return celsius + 273.15;
        }

        // Funzione Swap
        function swapUnits() {
            const temp = inputUnit.value;
            inputUnit.value = outputUnit.value;
            outputUnit.value = temp;
            convert();
        }

        // Listeners
        categorySelect.addEventListener('change', populateUnits);
        inputUnit.addEventListener('change', convert);
        outputUnit.addEventListener('change', convert);
        inputVal.addEventListener('input', convert);

        // Inizializzazione
        populateUnits();
    </script>
</body>
</html>